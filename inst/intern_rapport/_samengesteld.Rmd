```{r {{id}}-set}
if (interactive()) {
  composite_indices %>%
    sample_n(1) %>%
    pull(fingerprint) -> id
} else {
  id <- "{{id}}"
}
```


```{r {{id}}-basis}
composite_indices %>%
  filter(fingerprint == id, nonlinear) %>%
  transmute(
    parameter, 
    index = exp(mean), 
    se = (ucl - mean) / qnorm(0.975),
    analysis,
    status,
    model_type,
    cycle,
    species_group
  ) %>%
  inner_join(recent, by = "analysis") -> deze_index
deze_index %>%
  arrange(desc(timestamp)) %>%
  group_by(cycle) %>%
  slice(1) %>%
  semi_join(x = deze_index, by = "analysis") -> deze_index
soort_naam <- deze_index$species_group[1]
```

\pagebreak

## `r soort_naam`

```{r {{id}}-vlaanderen-cyclus-data}
deze_index %>%
  filter(cycle) %>%
  mutate(
    cyclus = factor(parameter)
  ) -> index_vlaanderen_cyclus
```

```{r {{id}}-vlaanderen-cyclus, fig.cap = paste0("Vlaamse samengestelde indices voor ", soort_naam, " op basis van data geaggregeerd per driejaarlijkse cyclus."), fig.height = 50 / 25.4}
if (nrow(index_vlaanderen_cyclus)) {
ggplot(
  index_vlaanderen_cyclus, 
  aes(x = cyclus, y = index, link_sd = se, group = analysis)
) +
  geom_hline(yintercept = 1, linetype = 3) +
  stat_fan(link = "log") +
  geom_line() +
  scale_y_continuous(
    labels = percent, limits = grenzen, breaks = index_breaks(grenzen)
  ) +
  theme(
    axis.title.x = element_blank()
  )
}
```

```{r {{id}}-vlaanderenjaar-data}
deze_index %>%
  filter(!cycle) %>%
  mutate(
    jaar = as.integer(parameter)
  ) -> index_vlaanderen_jaar
```

```{r {{id}}-vlaanderen-jaar, fig.cap = paste0("Vlaamse samengestelde indices voor ", soort_naam, " op basis van jaarlijkse data."), fig.height = 50 / 25.4}
if (nrow(index_vlaanderen_jaar)) {
ggplot(
  index_vlaanderen_jaar, 
  aes(x = jaar, y = index, link_sd = se, group = analysis)
) +
  geom_hline(yintercept = 1, linetype = 3) +
  stat_fan() +
  geom_line() +
  scale_y_log10(
    labels = percent, limits = grenzen, breaks = index_breaks(grenzen)
  ) +
  theme(
    axis.title.x = element_blank()
  )
}
```
